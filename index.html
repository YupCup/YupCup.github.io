<!DOCTYPE html>
<html lang="no">
    <head>
        <link rel="icon" href="https://cdn-icons-png.flaticon.com/512/5488/5488304.png">
        <meta charset="UTF-8">
        <title>Heimtun Bingo</title>

        <meta content="Heimtun Bingo" property="og:title" />
        <meta content="Daglig tilfeldig generert bingo!" property="og:description" />
        <meta content="https://yupcup.github.io/" property="og:url" />
        <meta content="https://www.griswoldhomecare.com/sub/49822/images/bigstock-Group-Of-Seniors-Playing-Game-258166369.jpg" property="og:image" />
        <meta content="#63e686" data-react-helmet="true" name="theme-color" />
        <meta name="twitter:card" content="summary_large_image">

        <style>
            :root {
                --boxSize: min(18vw, 200px);
                --n: 0
            }

            body {
                font-family:'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif;
                font-weight: 500;
                user-select: none;
                -webkit-tap-highlight-color: transparent;
            }

            .board {
                display: flex;
                justify-content: center;
            }
            .row {
                padding: 0px;

                margin-left: calc(var(--boxSize) / 20);
                margin-right: calc(var(--boxSize) / 20);
            }
            .box {
                outline: solid 3px black;
                border-radius: calc(var(--boxSize)/10);
                
                width: var(--boxSize);
                height: var(--boxSize);
                
                text-align: center;
                display: table;

                margin-top: calc(var(--boxSize) / 10);
                cursor: pointer;
                
                transition: .1s;
            }
            .box:hover:not(.clicked) {
                background-color: lightgray;
            }
            .box:active {
                scale: 98%;
            }
            .clicked {
                background-color: #f3f7b7;
            }
            .cleared {
                background-color: #63e686;
            }
            p {
                display: table-cell;
                vertical-align: middle;
                scale: 90%;
                font-size: calc(var(--boxSize) / 7);
                user-select: none;
                pointer-events: none;
            }
            h1 {
                text-align: center;
                user-select: none;
                padding-top: 50px;
                font-size: 50px;
            }

            .rainbow {
                animation-name: rainbowAnimation;
                animation-duration: 4s;
                animation-iteration-count: infinite;
                animation-delay: calc(var(--n) * 0.1s);
            }

            @-webkit-keyframes rainbowAnimation {
            0% {background-color:#63e686;}
            14% {background-color:#70ffcd;}
            28% {background-color:#6f52ff;}
            42% {background-color:#b647ff;}
            54% {background-color:#ff5754;}
            69% {background-color:#ffac54;}
            85% {background-color:#e3ff47;}
            100% {background-color:#87ff47;}
            }
            @keyframes rainbowAnimation {
            0% {background-color:#63e686;}
            14% {background-color:#70ffcd;}
            28% {background-color:#6f52ff;}
            42% {background-color:#b647ff;}
            54% {background-color:#ff5754;}
            69% {background-color:#ffac54;}
            85% {background-color:#e3ff47;}
            100% {background-color:#87ff47;}
            }
        </style>
    </head>
    <body>
        <h1>Heimtun Bingo!</h1>

        <div class="board">
            <div class="row">
                <div class="box"></div>
                <div class="box"></div>
                <div class="box"></div>
                <div class="box"></div>
                <div class="box"></div>
            </div>
            <div class="row">
                <div class="box"></div>
                <div class="box"></div>
                <div class="box"></div>
                <div class="box"></div>
                <div class="box"></div>
            </div>
            <div class="row">
                <div class="box"></div>
                <div class="box"></div>
                <div class="box"></div>
                <div class="box"></div>
                <div class="box"></div>
            </div>
            <div class="row">
                <div class="box"></div>
                <div class="box"></div>
                <div class="box"></div>
                <div class="box"></div>
                <div class="box"></div>
            </div>
            <div class="row">
                <div class="box"></div>
                <div class="box"></div>
                <div class="box"></div>
                <div class="box"></div>
                <div class="box"></div>
            </div>
        </div>

        <script src="bingoContent.js"></script>
        <script>
            const date = new Date();
            const dateNumber = date.getFullYear() * 10000 + date.getMonth() * 100 + date.getDate();

            CheckForDateChange();

            MergeContentLists();
            
            boxes = document.getElementsByClassName("box");

            boxesClicked = [];
            FillClickList();

            boxContentIndexes = [];
            if (localStorage.getItem("ContentIndexes") != null) {
                boxContentIndexes = JSON.parse(localStorage.getItem("ContentIndexes"));
            }
            console.log(boxContentIndexes);

            for (let i = 0; i < boxes.length; i++) {
                para = document.createElement("p");
                FillBox(i);
                AppendBox(i);
            }

            localStorage.setItem("ContentIndexes", JSON.stringify(boxContentIndexes));

            function CheckForLineComplete() {
                allCleared = true;
                for (let i=0; i<boxesClicked.length; i++) {
                    if (boxesClicked[i] == false)
                        allCleared = false;
                }

                for (let i=0; i<boxes.length; i++) {
                    SetClassActive(boxes[i].classList, "rainbow", allCleared);
                }

                CheckHorizontal();
                CheckVertical();
                CheckDiagonal();
            }

            function CheckForDateChange() {
                if (localStorage.getItem("lastDate") != null) {
                    if (localStorage.getItem("lastDate") != dateNumber) {
                        ResetBoard();
                    }
                }

                localStorage.setItem("lastDate", dateNumber);
            }

            function ResetBoard() {
                localStorage.removeItem("boxesClicked");
                localStorage.removeItem("ContentIndexes");
            }

            function MergeContentLists() {
                listToMerge = [];
                if (date.getDay() == 0 || 6)
                    listToMerge = saturdayList;
                else
                    listToMerge = weekdayList;

                bingoContent = [...bingoContent, ...listToMerge];
            }

            function FillClickList() {
                if (localStorage.getItem("boxesClicked") == null)
                    CreateClickList();
                else
                    FillClickListFromStorage();
            }

            function CreateClickList() {
                for (let i = 0; i<boxes.length; i++)
                    boxesClicked.push(false);

                localStorage.setItem("boxesClicked", JSON.stringify(boxesClicked));
            }

            function FillClickListFromStorage() {
                boxesClicked = JSON.parse(localStorage.getItem("boxesClicked"));

                for (let i = 0; i<boxesClicked.length; i++) {
                    if (boxesClicked[i])
                        boxes[i].classList.add("clicked");
                }

                CheckForLineComplete();
            }

            function FillBox(index) {
                contentList = bingoContent;
                prefix = "";

                if (index == 12) {
                    contentList = freeSpaces;
                    prefix = "FREE SPACE:\n";
                }

                if (boxContentIndexes.length > index) {
                    FillBoxFromStorage(index);
                    return;
                }
                
                randomIndex = Math.floor(Math.random() * contentList.length);
                while (boxContentIndexes.includes(randomIndex))
                    randomIndex = Math.floor(Math.random() * contentList.length);

                node = document.createTextNode(prefix + contentList[randomIndex]);

                boxContentIndexes.push(randomIndex);
            }

            function FillBoxFromStorage(index) {
                node = document.createTextNode(prefix + contentList[boxContentIndexes[index]]);
            }

            function AppendBox(index) {
                para.appendChild(node);
                boxes[index].appendChild(para);
                boxes[index].style.setProperty('--n', index%5+index/5);

                boxes[index].addEventListener("mousedown", (event) => {
                    ClickBox(event.target.classList, index);
                });
            }

            function ClickBox(classList, index) {
                ToggleClass(classList, "clicked")
                    
                boxesClicked[index] = classList.contains("clicked");
                localStorage.setItem("boxesClicked", JSON.stringify(boxesClicked));

                CheckForLineComplete();
            }

            function ToggleClass(classList, className) {
                if (!classList.contains(className))
                        classList.add(className);
                    else
                        classList.remove(className);
            }

            function SetClassActive(classList, className, active) {
                if (active) 
                    classList.add(className);
                else {
                    if (classList.contains(className))
                        classList.remove(className);
                }
            }
            
            function CheckHorizontal() {
                for (let x = 0; x<5; x++) {
                    lineClear = true;
                    for (let y = 0; y<5; y++) {
                        if (!boxesClicked[y*5+x]) {
                            lineClear = false;
                        }
                    }

                    for (let y = 0; y<5; y++) {
                        SetClassActive(boxes[y*5+x].classList, "cleared", lineClear);
                    }
                }
            }

            function CheckVertical() {
                for (let x = 0; x<5; x++) {
                    lineClear = true;
                    for (let y = 0; y<5; y++) {
                        if (!boxesClicked[y+x*5]) {
                            lineClear = false;
                        }
                    }

                    if (!lineClear)
                        continue;

                    for (let y = 0; y<5; y++) {
                        boxes[y+x*5].classList.add("cleared");
                    }
                }
            }

            function CheckDiagonal() {
                for (let i = 0; i<2; i++) {
                    lineClear = true;
                    for (let j = i; j<5+i; j++) {
                        if (!boxesClicked[j*(6-2*i)]) {
                            lineClear = false;
                        }
                    }

                    if (!lineClear)
                        continue;

                    for (let j = i; j<5+i; j++) {
                        boxes[j*(6-2*i)].classList.add("cleared");
                    }
                }
            }
        </script>
    </body>
</html>